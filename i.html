<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SAATHI – Sign Up & Document Upload</title>
<style>
  :root{--teal:#00796b;--link:#0b5bd3;--warn:#c62828;--amber:#fde7c5;--bar:#efeeda}
  *{box-sizing:border-box}
  body{margin:0;font-family:Arial,Helvetica,sans-serif;color:#1e1e1e;background:#fff}

  /* Header (same look as earlier pages) */
  .top-ribbon{font-size:12px;background:#f6f6f6;border-bottom:1px solid #e7e7e7}
  .wrap{max-width:1100px;margin:0 auto;padding:6px 12px}
  .brand-row{border-bottom:1px solid #e7e7e7;background:#fff}
  .brand-flex{display:flex;justify-content:space-between;align-items:center;gap:12px;padding:10px 12px}
  .brand-left,.brand-center,.brand-right{display:flex;align-items:center;gap:10px}
  .brand-left img,.brand-right img{height:54px}
  .saathi-title{font-weight:900;color:#0e6f8f;font-size:28px}
  .saathi-sub{font-size:12px;color:#555;margin-top:-6px}
  .menu{display:flex;gap:8px;flex-wrap:wrap;padding:8px 12px}
  .menu a{padding:6px 8px;border-radius:4px;color:#0b5bd3;text-decoration:none}
  .menu a:hover{background:#eef4ff}
  .muted{font-size:12px;color:#666}

  /* Page title */
  .page{padding:16px 0}
  .title-bar{background:var(--teal);color:#fff;padding:10px 12px;border-radius:4px 4px 0 0}
  .card{border:1px solid #ddd;border-top:none;border-radius:0 0 8px 8px;background:#fff}

  /* Section shells */
  .sect{border:1px solid #ddd;margin:16px 0;background:#fff}
  .sect .head{background:var(--amber);padding:8px 12px;font-weight:700;border-bottom:1px solid #ddd}
  .sect .body{padding:12px}

  /* Form grid */
  .row{display:grid;grid-template-columns:200px 1fr 160px 1fr;gap:10px;margin:10px 0}
  .row.two{grid-template-columns:200px 1fr}
  label{font-size:14px}
  input[type="text"],input[type="email"],input[type="password"],select{
    width:100%;padding:8px;border:1px solid #bbb;border-radius:4px;background:#fff
  }
  .note{font-size:12px;color:#b22222;margin-top:6px}

  /* Password rules */
  .pw-rules{display:flex;flex-wrap:wrap;gap:10px;margin-top:6px}
  .rule{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid #ccc}
  .rule.ok{background:#e6f7e9;border-color:#9ed2a0;color:#0c6d2e}
  .rule.bad{background:#fff3f3;border-color:#f3b1b1;color:#b00020}

  /* Captcha */
  .captcha-wrap{display:flex;align-items:center;gap:12px}
  .captcha-box{font-size:28px;font-weight:800;letter-spacing:3px;background:#f3f7ef;border:1px dashed #9bb58a;padding:8px 14px;border-radius:6px}
  .cap-refresh{border:none;background:#e9f2ff;color:#0b5bd3;border:1px solid #b7d0ff;padding:6px 10px;border-radius:6px;cursor:pointer}
  .cap-refresh:hover{background:#dcebff}

  /* Upload tables */
  table{width:100%;border-collapse:collapse;background:#fff}
  th,td{border:1px solid #cfcfcf;padding:8px;text-align:left}
  th{background:#dfeeea}
  .btn{border:1px solid #0b5bd3;background:#fff;color:#0b5bd3;padding:8px 12px;border-radius:6px;font-weight:700;cursor:pointer}
  .btn.primary{background:var(--teal);border-color:var(--teal);color:#fff}
  .btn.gray{background:#555;border-color:#555;color:#fff}
  .btn.red{background:#b23b3b;border-color:#b23b3b;color:#fff}
  .btn.small{padding:6px 10px;font-weight:600}
  .inline{display:inline-flex;align-items:center;gap:8px}
  .chip{display:inline-block;background:#eef8ff;border:1px solid #cfe6ff;color:#0b5bd3;border-radius:999px;padding:2px 8px;font-size:12px;margin-left:6px}

  .actions{text-align:center;margin:22px 0 40px}
  .decl{margin-top:10px}
  .count{font-size:12px;color:#444}

  /* Modals */
  .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:999}
  .modal{width:min(680px,92vw);background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,.35)}
  .modal .head{background:var(--teal);color:#fff;padding:12px 16px;font-weight:800;display:flex;justify-content:space-between}
  .modal .body{padding:16px}
  .modal .foot{padding:12px 16px;border-top:1px solid #eee;display:flex;gap:10px;justify-content:flex-end}
  .pill-note{background:#f4faf4;border:1px solid #bfe2bf;padding:8px;border-radius:6px;font-size:14px}
  .otp-input{padding:10px;font-size:18px;letter-spacing:4px;text-align:center;border:1px solid #bbb;border-radius:6px;width:240px}
  .timer{font-family:monospace;font-weight:700;margin-top:6px}
  .success-msg{font-size:18px;line-height:1.5}

  /* DigiLocker mini UI */
  .locker-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
  .locker-card{border:1px solid #d9e7ff;background:#f6f9ff;border-radius:8px;padding:10px}
  .locker-card h4{margin:6px 0}
  .locker-card button{margin-top:8px}
  @media (max-width:900px){.row,.row.two{grid-template-columns:1fr}}
</style>
</head>
<body>

<!-- ===== Header ===== -->
<div class="top-ribbon">
  <div class="wrap" style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap">
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <a href="#" class="muted">Latest Announcements</a> |
      <a href="#" class="muted">FAQ</a> |
      <a href="#" class="muted">Helpdesk: helpdesk@saathi.gov.in</a> |
      <span class="muted">Call: 1800-11-2100</span>
    </div>
    <a href="#" class="muted">A+ | A | A-</a>
  </div>
</div>
<div class="brand-row">
  <div class="wrap brand-flex">
    <div class="brand-left">
      <img src="assets/india-emblem.png" alt="Government of India"><span class="muted">Government of India</span>
    </div>
    <div class="brand-center" style="flex-direction:column;align-items:center;text-align:center">
      <div class="saathi-title">SAATHI</div>
      <div class="saathi-sub">Single Access Approval Touchless Hub Interface</div>
    </div>
    <div class="brand-right"><img src="assets/eat-right-india.png" alt="Initiative"></div>
  </div>
</div>
<div class="wrap menu">
  <a href="index.html">Home</a>
  <a href="#">About SAATHI</a>
  <a href="#">Track Application</a>
  <a href="#">Help</a>
  <a href="#">User Manual</a>
</div>

<!-- ===== Page ===== -->
<div class="wrap page">
  <div class="title-bar">Sign Up Details</div>
  <div class="card" style="padding:12px">

    <!-- Primary Contact -->
    <div class="sect">
      <div class="head">Primary Contact Detail</div>
      <div class="body">
        <div class="row">
          <label for="pEmail">Email</label>
          <input id="pEmail" type="email" placeholder="name@example.com">
          <label for="pMobile">Mobile No.</label>
          <input id="pMobile" type="text" placeholder="10 digits">
        </div>
        <div class="row">
          <label for="pBelongs">Belongs To <span style="color:#d32f2f">*</span></label>
          <select id="pBelongs">
            <option value="">Please Select</option>
            <option>Proprietor</option>
            <option>Partner</option>
            <option>Authorized Signatory</option>
            <option>Other</option>
          </select>
          <div></div><div></div>
        </div>
        <div class="note">NOTE: At least one of the two (Email/Mobile No) is mandatory.</div>
      </div>
    </div>

    <!-- Secondary Contact -->
    <div class="sect">
      <div class="head">Secondary Contact Detail</div>
      <div class="body">
        <div class="row">
          <label for="sEmail">Email</label>
          <input id="sEmail" type="email" placeholder="name@example.com">
          <label for="sMobile">Mobile No.</label>
          <input id="sMobile" type="text" placeholder="10 digits">
        </div>
        <div class="row two">
          <label for="sBelongs">Belongs To</label>
          <select id="sBelongs">
            <option value="">Please Select</option>
            <option>Proprietor</option>
            <option>Partner</option>
            <option>Authorized Signatory</option>
            <option>Other</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Login Credential -->
    <div class="sect">
      <div class="head">Login Credential</div>
      <div class="body">
        <div class="row two">
          <label for="loginId">Login Id <span style="color:#d32f2f">*</span></label>
          <input id="loginId" type="text" placeholder="Your Application Reference or custom ID">
        </div>

        <div class="row">
          <label for="password">Password <span style="color:#d32f2f">*</span></label>
          <input id="password" type="password" placeholder="6–21 chars, 1 uppercase, 1 digit, 1 special">
          <label for="confirm">Confirm Password <span style="color:#d32f2f">*</span></label>
          <input id="confirm" type="password" placeholder="Re-enter password">
        </div>

        <div class="pw-rules" id="pwRules">
          <span class="rule bad" data-rule="len">6–21 characters</span>
          <span class="rule bad" data-rule="upper">at least 1 uppercase</span>
          <span class="rule bad" data-rule="digit">at least 1 digit</span>
          <span class="rule bad" data-rule="special">at least 1 special (!,@,#,$,%,^,&,*,?,_,~)</span>
          <span class="rule bad" data-rule="match">passwords match</span>
        </div>

        <div class="row two" style="align-items:center;margin-top:12px">
          <label>Captcha</label>
          <div class="captcha-wrap">
            <div id="captchaText" class="captcha-box">123456</div>
            <button class="cap-refresh" type="button" onclick="regenCaptcha()">↻ Refresh</button>
          </div>
        </div>
        <div class="row two">
          <label for="captchaInput">Enter Captcha <span style="color:#d32f2f">*</span></label>
          <input id="captchaInput" type="text" placeholder="Type the numbers shown">
        </div>
      </div>
    </div>

    <!-- Upload Document(s) -->
    <div class="sect">
      <div class="head">Upload Document(s)/Payment</div>
      <div class="body">
        <div class="note" style="margin-bottom:10px">
          <b>Upload Document(s) (Max File Size: 5MB, type: pdf, jpeg, jpg, png)</b><br>
          All documents shall be self-attested by Authorized Signatory/Proprietor/Individual or Applicant before uploading.
        </div>

        <table>
          <thead>
            <tr>
              <th style="width:60px">S.No.</th>
              <th>Document Type</th>
              <th>Upload</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <!-- Photo -->
            <tr>
              <td>1</td>
              <td>Photo <span style="color:#d32f2f">*</span></td>
              <td>
                <div class="inline">
                  <input type="file" id="photoFile" accept=".pdf,.jpeg,.jpg,.png">
                  <button class="btn small" onclick="uploadPhoto()">Upload</button>
                </div>
              </td>
              <td id="photoStatus">Pending</td>
            </tr>

            <!-- Identity Proof -->
            <tr>
              <td>2</td>
              <td>
                <div class="inline">
                  <label>Identity Proof <span style="color:#d32f2f">*</span></label>
                  <select id="idType" style="margin-left:8px">
                    <option value="">Select Identity Types</option>
                    <option>Aadhar Card</option>
                    <option>PAN Card</option>
                    <option>Voter ID</option>
                    <option>Driving License</option>
                    <option>Passport</option>
                  </select>
                </div>
              </td>
              <td>
                <div class="inline">
                  <input type="file" id="idFile" accept=".pdf,.jpeg,.jpg,.png">
                  <button class="btn small" onclick="uploadIdentity()">Upload</button>
                  <span class="chip">or</span>
                  <button class="btn small" onclick="openLocker()">Fetch from DigiLocker</button>
                </div>
              </td>
              <td id="idStatus">Pending</td>
            </tr>
          </tbody>
        </table>

        <!-- Other Documents -->
        <h3 style="margin:18px 0 6px">Other Document</h3>
        <div class="note">
          1. Upload State specific documents in this section. <a href="#" onclick="alert('Open Mandatory Documents PDF');return false;">(View Mandatory Documents)</a><br>
          2. Maximum of <b>15</b> documents can be uploaded. If you have more than 15 then please merge your documents and upload it.<br>
          3. You have uploaded <b><span id="otherCount">0</span></b> out of 15 documents.
        </div>

        <table style="margin-top:10px">
          <thead>
            <tr>
              <th style="width:60px">Sl. No.</th>
              <th>Document Description</th>
              <th>Upload Document(s)</th>
              <th>Status / Action</th>
            </tr>
          </thead>
          <tbody id="otherTable">
            <tr>
              <td>—</td>
              <td>
                <select id="otherDesc">
                  <option value="">Select</option>
                  <option>Address Proof of Premises (Rent Agreement/Tax Receipt)</option>
                  <option>Partnership Deed/Board Resolution/Authorization Letter</option>
                  <option>Layout Plan/Blueprint</option>
                  <option>NOC from Municipality/Local Body</option>
                  <option>Declaration/Undertaking</option>
                </select>
              </td>
              <td>
                <div class="inline">
                  <input type="file" id="otherFile" accept=".pdf,.jpeg,.jpg,.png">
                  <button class="btn small" onclick="uploadOther()">Upload</button>
                </div>
              </td>
              <td class="count">Add rows up to 15</td>
            </tr>
          </tbody>
        </table>

        <!-- Declaration -->
        <div class="decl">
          <label>
            <input type="checkbox" id="declCheck">
            I/We declare that –
          </label>
          <ul>
            <li>I/We have read, understood and shall abide all provisions of FSS Act, 2006 and Rules, Regulations made therein and orders issued from time to time applicable to declared food business.</li>
            <li>I/We assure that articles of food mentioned in form satisfy the requirements of FSS Act 2006, Rules and Regulations made thereunder.</li>
            <li>I/We shall comply with the general hygiene and sanitary requirements as mentioned in Schedule 4 of the FSS (Licensing and Registration of Food Businesses) Regulations, 2011.</li>
            <li>Expected Annual turnover of the food business is under Rs. 12 Lacs. I will apply for License as and when annual turnover exceeds Rs. 12 Lacs.</li>
            <li>I have read/understood the punishment provision under Section 61 of FOOD SAFETY AND STANDARDS ACT, 2006.</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="actions">
      <button id="submitBtn" class="btn primary" onclick="submitSignup()">Submit</button>
    </div>
  </div>
</div>

<!-- ===== DigiLocker Modal ===== -->
<div class="backdrop" id="lockerBack">
  <div class="modal">
    <div class="head">
      <span>DigiLocker</span>
      <button class="btn" onclick="closeLocker()">Close</button>
    </div>
    <div class="body">
      <div class="pill-note">Simulated DigiLocker: pick a document to link as your Identity Proof. (No external calls are made.)</div>
      <div class="locker-grid">
        <div class="locker-card">
          <h4>Aadhaar Card</h4>
          <div class="muted">UID: 87******47</div>
          <button class="btn small" onclick="pickLocker('Aadhar Card','Aadhaar_87XXXX47.pdf')">Link</button>
        </div>
        <div class="locker-card">
          <h4>PAN Card</h4>
          <div class="muted">ABCDE1234F</div>
          <button class="btn small" onclick="pickLocker('PAN Card','PAN_ABCDE1234F.pdf')">Link</button>
        </div>
        <div class="locker-card">
          <h4>Voter ID</h4>
          <div class="muted">MH/12/123456</div>
          <button class="btn small" onclick="pickLocker('Voter ID','VoterID_MH12123456.pdf')">Link</button>
        </div>
        <div class="locker-card">
          <h4>Driving License</h4>
          <div class="muted">MH14 2020XXXX</div>
          <button class="btn small" onclick="pickLocker('Driving License','DL_MH14_2020XXXX.pdf')">Link</button>
        </div>
      </div>
    </div>
    <div class="foot">
      <button class="btn" onclick="closeLocker()">Cancel</button>
    </div>
  </div>
</div>

<!-- ===== OTP Modal ===== -->
<div class="backdrop" id="otpBack">
  <div class="modal">
    <div class="head">
      <span>Confirm Verification Code</span>
      <button class="btn" onclick="closeOtp()">Close</button>
    </div>
    <div class="body">
      <div id="otpMsg" class="pill-note" style="margin-bottom:12px">
        Verification code has been sent to Email and Mobile.
      </div>
      <input id="otpInput" class="otp-input" maxlength="6" placeholder="Enter OTP"/>
      <div class="timer" id="otpTimer">09:59</div>
      <div style="margin-top:10px" class="muted">
        If you have not received OTP on SMS, please <a href="#" onclick="regenOtp();return false;">click here</a> for OTP on Call.
      </div>
    </div>
    <div class="foot">
      <button class="btn" onclick="closeOtp()">Close</button>
      <button class="btn primary" onclick="verifyOtp()">Submit</button>
    </div>
  </div>
</div>

<!-- ===== Success Modal ===== -->
<div class="backdrop" id="okBack">
  <div class="modal">
    <div class="head">
      <span>User Sign Up Successfully</span>
      <button class="btn" onclick="goToPayment()">✕</button>
    </div>
    <div class="body">
      <div class="success-msg">
        You have registered with <b>SAATHI</b> and login id created <b>Successfully</b>.<br/>
        Your login id is <b id="finalLoginId">3027XXXX</b>.
      </div>
      <div class="muted" style="margin-top:10px">
        <b>Note:</b> Once registration certificate is generated, the registration certificate number will be your login ID.
      </div>
      <div style="text-align:center;margin-top:14px">
        <button class="btn primary" onclick="goToPayment()">Ok</button>
      </div>
    </div>
  </div>
</div>

<script>
  /* ---------- Helpers ---------- */
  function genDigits(n=6){ return Array.from({length:n},()=>Math.floor(Math.random()*10)).join(''); }
  function isEmail(x){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x); }
  function isMobile(x){ return /^[6-9]\d{9}$/.test(x); }
  function maskEmail(email){
    if(!email || !email.includes('@')) return '';
    const [u, d] = email.split('@'); const vis=u.slice(0,2);
    return `${vis}${'*'.repeat(Math.max(4,u.length-2))}@${d.replace(/.(?=.*\.)/g,'*')}`;
  }
  function maskMobile(mob){ if(!mob) return ''; return mob.replace(/^(\d{2})\d{6}(\d{2})$/, '$1XXXXXX$2'); }

  /* ---------- Captcha ---------- */
  let currentCaptcha = "";
  function regenCaptcha(){ currentCaptcha = genDigits(6); document.getElementById('captchaText').textContent = currentCaptcha; }
  regenCaptcha();

  /* ---------- Password rules ---------- */
  const pw = document.getElementById('password');
  const cf = document.getElementById('confirm');
  function applyRule(ok, key){
    const el = document.querySelector(`.rule[data-rule="${key}"]`);
    el.classList.toggle('ok', ok); el.classList.toggle('bad', !ok);
  }
  function validatePw(){
    const v = pw.value;
    const len = v.length>=6 && v.length<=21;
    const upper = /[A-Z]/.test(v);
    const digit = /[0-9]/.test(v);
    const special = /[!@#$%^&*?_~]/.test(v);
    const match = v && v === cf.value;
    applyRule(len,'len'); applyRule(upper,'upper'); applyRule(digit,'digit'); applyRule(special,'special'); applyRule(match,'match');
    return len && upper && digit && special && match;
  }
  pw.addEventListener('input', validatePw); cf.addEventListener('input', validatePw);

  /* ---------- Uploads state ---------- */
  let photoUploaded = false;
  let idUploaded = false;       // true if file OR digilocker linked
  let idViaLocker = false;
  const otherDocs = [];         // {desc, name, size}

  const ALLOWED = ['application/pdf','image/jpeg','image/png'];
  const MAX = 5*1024*1024;

  function checkFile(input){
    const f = input.files[0];
    if(!f){ alert('Please choose a file.'); return null; }
    if(!ALLOWED.includes(f.type)){ alert('Only PDF/JPEG/JPG/PNG allowed.'); return null; }
    if(f.size>MAX){ alert('File too large. Max 5MB.'); return null; }
    return f;
  }

  function uploadPhoto(){
    const f = checkFile(document.getElementById('photoFile')); if(!f) return;
    photoUploaded = true;
    document.getElementById('photoStatus').innerHTML = `Uploaded <span class="chip">${f.name}</span>`;
  }

  function uploadIdentity(){
    const type = document.getElementById('idType').value;
    if(!type){ alert('Please select Identity Type.'); return; }
    const f = checkFile(document.getElementById('idFile')); if(!f) return;
    idUploaded = true; idViaLocker = false;
    document.getElementById('idStatus').innerHTML = `Uploaded (${type}) <span class="chip">${f.name}</span>`;
  }

  function uploadOther(){
    if(otherDocs.length>=15){ alert('Maximum 15 documents reached.'); return; }
    const desc = document.getElementById('otherDesc').value;
    if(!desc){ alert('Choose document description.'); return; }
    const f = checkFile(document.getElementById('otherFile')); if(!f) return;
    otherDocs.push({desc,name:f.name,size:f.size});
    renderOtherTable();
  }

  function renderOtherTable(){
    const tbody = document.getElementById('otherTable');
    // keep first template row, then append others below it
    tbody.querySelectorAll('tr.uploaded').forEach(tr=>tr.remove());
    otherDocs.forEach((d,i)=>{
      const tr = document.createElement('tr'); tr.className='uploaded';
      tr.innerHTML = `
        <td>${i+1}</td>
        <td>${d.desc}</td>
        <td>${d.name}</td>
        <td><button class="btn small red" onclick="removeOther(${i})">Remove</button></td>`;
      tbody.appendChild(tr);
    });
    document.getElementById('otherCount').textContent = otherDocs.length;
    document.getElementById('otherFile').value = "";
    document.getElementById('otherDesc').value = "";
  }

  function removeOther(idx){ otherDocs.splice(idx,1); renderOtherTable(); }

  /* ---------- DigiLocker (simulated) ---------- */
  function openLocker(){ document.getElementById('lockerBack').style.display='flex'; }
  function closeLocker(){ document.getElementById('lockerBack').style.display='none'; }
  function pickLocker(type, filename){
    document.getElementById('idType').value = type;
    idUploaded = true; idViaLocker = true;
    document.getElementById('idStatus').innerHTML = `Linked via DigiLocker (${type}) <span class="chip">${filename}</span>`;
    closeLocker();
  }

  /* ---------- OTP flow ---------- */
  let generatedOTP = null;
  let otpCountdown = null;
  function startTimer(sec=600){
    const el = document.getElementById('otpTimer');
    clearInterval(otpCountdown);
    otpCountdown = setInterval(()=>{
      if(sec<=0){ clearInterval(otpCountdown); el.textContent = "00:00"; return; }
      sec--;
      const m = String(Math.floor(sec/60)).padStart(2,'0');
      const s = String(sec%60).padStart(2,'0');
      el.textContent = `${m}:${s}`;
    },1000);
  }
  function openOtp(){
    document.getElementById('otpBack').style.display='flex';
    document.getElementById('otpInput').value='';
    generatedOTP = genDigits(6);
    startTimer(600);
  }
  function closeOtp(){ document.getElementById('otpBack').style.display='none'; clearInterval(otpCountdown); }
  function regenOtp(){ generatedOTP = genDigits(6); startTimer(600); alert('OTP re-generated.'); }

  function verifyOtp(){
    const val = document.getElementById('otpInput').value.trim();
    if(val !== generatedOTP){ alert('Invalid OTP. Please try again.'); return; }
    closeOtp();

    // ====== SAVE DATA FOR e.html PRINTING ======
    const loginIdVal = document.getElementById('loginId').value.trim() || ('302' + genDigits(5));
    document.getElementById('finalLoginId').textContent = loginIdVal;

    const signupData = {
      applicant: document.getElementById('appName')?.value || '', // optional field if you add it
      loginId:   loginIdVal,
      pEmail:    document.getElementById('pEmail').value.trim(),
      pMobile:   document.getElementById('pMobile').value.trim(),
      pBelongs:  document.getElementById('pBelongs').value.trim()
    };
    const uploadData = {
      photo: { ok: photoUploaded, name: document.getElementById('photoFile')?.files?.[0]?.name || '' },
      id:    { ok: idUploaded, type: document.getElementById('idType')?.value || (idViaLocker?'DigiLocker':''), name: document.getElementById('idFile')?.files?.[0]?.name || (idViaLocker ? 'DigiLocker Document' : '') },
      other: (otherDocs || [])
    };
    localStorage.setItem('signupData', JSON.stringify(signupData));
    localStorage.setItem('uploadData', JSON.stringify(uploadData));
    localStorage.setItem('finalLoginId', loginIdVal);
    // ===========================================

    // show success modal
    document.getElementById('okBack').style.display='flex';
  }

  function goToPayment(){ window.location.href = 'e.html'; }

  /* ---------- Submit ---------- */
  function submitSignup(){
    // Contact basics
    const pEmail = document.getElementById('pEmail').value.trim();
    const pMobile = document.getElementById('pMobile').value.trim();
    const pBelongs = document.getElementById('pBelongs').value.trim();
    const loginId = document.getElementById('loginId').value.trim();
    const captchaInput = document.getElementById('captchaInput').value.trim();

    if(!pEmail && !pMobile){ alert('Provide at least one among Primary Email or Mobile.'); return; }
    if(pEmail && !isEmail(pEmail)){ alert('Primary Email is invalid.'); return; }
    if(pMobile && !isMobile(pMobile)){ alert('Primary Mobile must be 10 digits starting 6–9.'); return; }
    if(!pBelongs){ alert('Please select "Belongs To" in Primary Contact.'); return; }
    if(!loginId){ alert('Please enter Login Id.'); return; }
    if(!validatePw()){ alert('Please satisfy all password rules and ensure both passwords match.'); return; }
    if(captchaInput !== currentCaptcha){ alert('Captcha does not match.'); return; }

    // Upload requirements
    if(!photoUploaded){ alert('Please upload your Photo.'); return; }
    if(!idUploaded){ alert('Please upload/attach an Identity Proof (file or DigiLocker).'); return; }

    // Declaration
    if(!document.getElementById('declCheck').checked){
      alert('You must accept the declaration.');
      return;
    }

    // Passed → open OTP modal
    const msg = `Verification code has been sent to Email Id ${maskEmail(pEmail)} & Mobile No. ${maskMobile(pMobile)}.`;
    document.getElementById('otpMsg').textContent = msg;
    openOtp();
  }

  // Close modals via click-outside / ESC
  document.getElementById('otpBack').addEventListener('click', e=>{ if(e.target.id==='otpBack') closeOtp(); });
  document.getElementById('okBack').addEventListener('click', e=>{ if(e.target.id==='okBack') goToPayment(); });
  document.getElementById('lockerBack').addEventListener('click', e=>{ if(e.target.id==='lockerBack') closeLocker(); });
  document.addEventListener('keydown', e=>{
    if(e.key==='Escape'){ closeOtp(); document.getElementById('okBack').style.display='none'; closeLocker(); }
  });
</script>
</body>
</html>
